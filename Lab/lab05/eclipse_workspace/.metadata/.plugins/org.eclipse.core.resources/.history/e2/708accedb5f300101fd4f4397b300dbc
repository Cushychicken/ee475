/*
 * gps.c
 *
 *  Created on: Oct 3, 2011
 *      Author: nash.reilly
 */

#include <stdio.h>
#include <string.h>
#include "lcdwrite.h"
#include "gpsparse.h"

#define Switches (volatile int *) 0x01001030
#define LEDs 	 (int *) 		  0x01001020
#define M_TO_FT(x) (x*3.28);

int main()
{
	char test;
	char cs;
	char pkt[83];
	char print[] = "Sixteen LCD char";
	struct packet packet_GGA;
	int temp;
	int time;
	double elev;

	while(1){
		test=getchar();																/*Gets first character from serial stream             */

		*LEDs = *Switches;
		temp  = *LEDs;

		if(checksum(test,cs,pkt)){													/*Pipes all the fun stuff to checksum and parse f'ns  */
			parse_GGA(pkt, &packet_GGA);												/*See gpsparse.h library for full view of functions   */
			//WriteLCD(packet_GGA.latitude);
			WriteLCD(packet_GGA.time);
			temp = (temp & 0x01);
			if (temp == 1){
				sprintf(print, "Lat: %s %c", packet_GGA.latitude, packet_GGA.ns[0]);
				WriteLCD(print);
				sprintf(print, "Lon: %s %c", packet_GGA.longitude, packet_GGA.ew[0]);
				WriteLCD(print);
			};
			if (temp == 0){
				elev = chartoint(packet_GGA.ant_ht);
				elev = M_TO_FT(elev);
				sprintf(print, "Elev: %d ft", )
			}
		} else {
			sprintf(print, "GPS not ready.");
			WriteLCD(print);
		}

	};
	return 0;
}




